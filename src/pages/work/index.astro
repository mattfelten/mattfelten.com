---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';

import Section from '@components/Section.astro';
import Layout from '@layouts/default.astro';

const work = (await getCollection('work')).sort((a, b) => {
	// Sort by most recent year (endYear if exists, otherwise year)
	const aYear = a.data.active ? Infinity : (a.data.endYear || a.data.year);
	const bYear = b.data.active ? Infinity : (b.data.endYear || b.data.year);
	return bYear - aYear;
});

function formatYear(year: number, endYear?: number, active?: boolean) {
	if (active) return `${year} – Present`;
	if (endYear && endYear !== year) return `${year}–${endYear}`;
	return year.toString();
}
---

<Layout title="Work">
	<Section title="Work">
		<ul class="space-y-12">
			{work.map(({ data: { title, company, year, endYear, active, intro, cover, coverAlt }, slug }) => (
				<li>
					<a
						href={`/work/${slug}`}
						class="group block"
					>
						{cover && coverAlt && (
							<div class="hover bg-accent/50 mb-4 aspect-video overflow-hidden rounded-lg shadow-lg">
								<Image src={cover} alt={coverAlt} class="h-full w-full object-cover" />
							</div>
						)}
						<div class="flex flex-col gap-1">
							<div class="text-subdued text-sm font-medium">
								{company} · {formatYear(year, endYear, active)}
							</div>
							<h2 class="text-strong group-hover:text-accent text-2xl font-medium transition-colors">
								{title}
							</h2>
							<p class="text-default line-length-md">
								{intro}
							</p>
						</div>
					</a>
				</li>
			))}
		</ul>
	</Section>
</Layout>
