---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';

import Section from '@components/Section.astro';

const work = (await getCollection('work'))
	.filter(item => item.data.featured)
	.sort((a, b) => {
		// Sort by most recent year (active first, then by endYear/year)
		const aYear = a.data.active ? Infinity : (a.data.endYear || a.data.year);
		const bYear = b.data.active ? Infinity : (b.data.endYear || b.data.year);
		return bYear - aYear;
	});
---

{
	work.length > 0 && (
		<Section title="Selected Work" href="/work">
			<ul class="space-y-8 text-xl">
				{work.map(
					({
						data: {
							company,
							cover,
							coverAlt,
							intro,
							title,
						},
						slug,
					}) => (
						<li>
							<p class="line-length-lg">
								<a
									href={`/work/${slug}`}
									class="decoration-accent text-strong group font-medium whitespace-nowrap underline decoration-2 underline-offset-4 hover:decoration-3 focus:outline-0"
								>
									{title}
								</a>
								{' â€” '}
								<span>{intro}</span>
							</p>
							{cover && coverAlt && (
								<a href={`/work/${slug}`} class="block">
									<div class="hover bg-accent/50 mt-4 aspect-video overflow-hidden rounded-lg shadow-2xl">
										<Image src={cover} alt={coverAlt} class="h-full w-full object-cover" />
									</div>
								</a>
							)}
						</li>
					),
				)}
			</ul>
		</Section>
	)
}
